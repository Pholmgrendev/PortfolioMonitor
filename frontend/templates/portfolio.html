<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio</title>
</head>
<body>
    <h1>Portfolio: {{ portfolio.name }}</h1>

    <!-- Display flashed messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul>
                {% for category, message in messages %}
                    <li class="{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <h2>Holdings</h2>
    <table>
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Shares</th>
                <th>Price Per Share (USD)</th>
                <th>Value (USD)</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for holding in holdings %}
            <tr>
                <td>{{ holding.ticker.symbol }}</td>
                <td>{{ holding.shares }}</td>
                <td>${{ "%.2f"|format(holding.ticker.quote.price) }}</td>
                <td>${{ "%.2f"|format(holding.value) }}</td>
                <td>
                    <form action="{{ url_for('remove_holding', holding_id=holding.id) }}" method="post" style="display:inline;">
                        <button type="submit">Remove</button>
                    </form>
                    <button onclick="document.getElementById('edit-form-{{ holding.id }}').style.display='block'">Edit</button>
                    <a href="{{ url_for('price_history', ticker_id=holding.ticker.id) }}">View Price History</a>
                </td>
            </tr>
            <tr id="edit-form-{{ holding.id }}" style="display:none;">
                <td colspan="4">
                    <form action="{{ url_for('edit_holding', holding_id=holding.id) }}" method="post">
                        <label for="shares-{{ holding.id }}">Shares:</label>
                        <input type="number" id="shares-{{ holding.id }}" name="shares" value="{{ holding.shares }}" required>
                        <button type="submit">Update</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Total Value: ${{ "%.2f"|format(portfolio.total_value) }}</h2>

    <h2>Add Holding</h2>
    <!-- TODO: update symbol field to pull list of available symbols -->
    <form action="{{ url_for('add_holding') }}" method="post">
        <label for="symbol">Symbol:</label>
        <input type="text" id="symbol" name="symbol" required>
        <label for="shares">Shares:</label>
        <input type="number" id="shares" name="shares" required>
        <button type="submit">Add</button>
    </form>
</body>
</html>